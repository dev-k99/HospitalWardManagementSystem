@page
@model ProductModel
@{
    ViewData["Title"] = "Product";
}
<div class="container mt-4" id="product">
    Loading...
</div>

@section Scripts{
<script>
(async function(){
    const params = new URLSearchParams(location.search);
    const id = params.get('id');
    const res = await fetch(`/api/products/${id}`);
    if(!res.ok){ document.getElementById('product').innerHTML = 'Not found'; return; }
    const p = await res.json();
    document.getElementById('product').innerHTML = `
        <div class="row">
            <div class="col-md-6"><img src="${p.imageUrl || 'https://placehold.co/600x400'}" class="img-fluid"/></div>
            <div class="col-md-6">
                <h2>${p.name}</h2>
                <p>${p.description || ''}</p>
                <h4>$${p.price?.toFixed(2)}</h4>
                <button class="btn btn-success" id="add">Add to Cart</button>
            </div>
        </div>`;
    document.getElementById('add').addEventListener('click', async () => {
        const token = localStorage.getItem('jwt');
        const r = await fetch(`/api/cart/add?productId=${p.id}&quantity=1`, { method:'POST', headers: { 'Authorization': `Bearer ${token}` }});
        alert(r.ok ? 'Added to cart' : 'Login required');
    });
})();
</script>
}
