@model WardSystemProject.Models.Patient

@{
    ViewData["Title"] = $"Patient Folder - {Model.FullName}";
}

<div class="container-fluid">
    <!-- Header -->
    <div class="row mb-4">
        <div class="col-md-8">
            <h2 class="text-primary">
                <i class="bi bi-folder2-open"></i> Patient Folder
            </h2>
            <h4 class="text-dark">@Model.FullName</h4>
            <p class="text-muted">Patient ID: @Model.Id | Age: @Model.Age years</p>
        </div>
        <div class="col-md-4 text-end">
            <div class="btn-group" role="group">
                <a asp-action="Edit" asp-route-id="@Model.Id" class="btn btn-warning">
                    <i class="bi bi-pencil"></i> Edit
                </a>
                <a asp-action="Movement" asp-route-id="@Model.Id" class="btn btn-info">
                    <i class="bi bi-arrow-left-right"></i> Record Movement
                </a>
                <a asp-action="Discharge" asp-route-id="@Model.Id" class="btn btn-danger">
                    <i class="bi bi-box-arrow-right"></i> Discharge
                </a>
            </div>
        </div>
    </div>

    <!-- Status Alert -->
    @if (Model.IsCurrentlyAdmitted)
    {
        <div class="alert alert-success">
            <i class="bi bi-check-circle"></i>
            <strong>Currently Admitted</strong> - Admitted on @Model.AdmissionDate?.ToString("dd/MM/yyyy HH:mm")
        </div>
    }
    else if (Model.DischargeDate.HasValue)
    {
        <div class="alert alert-warning">
            <i class="bi bi-box-arrow-right"></i>
            <strong>Discharged</strong> - Discharged on @Model.DischargeDate?.ToString("dd/MM/yyyy HH:mm")
        </div>
    }

    <div class="row">
        <!-- Patient Information -->
        <div class="col-md-6">
            <div class="card shadow-sm mb-4">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0">
                        <i class="bi bi-person"></i> Patient Information
                    </h5>
                </div>
                <div class="card-body">
                    <dl class="row">
                        <dt class="col-sm-4">Full Name</dt>
                        <dd class="col-sm-8">@Model.FullName</dd>

                        <dt class="col-sm-4">Date of Birth</dt>
                        <dd class="col-sm-8">@Model.DateOfBirth.ToString("dd/MM/yyyy")</dd>

                        <dt class="col-sm-4">Gender</dt>
                        <dd class="col-sm-8">@Model.Gender</dd>

                        <dt class="col-sm-4">Contact Number</dt>
                        <dd class="col-sm-8">@Model.ContactNumber</dd>

                        <dt class="col-sm-4">Blood Type</dt>
                        <dd class="col-sm-8">
                            @if (!string.IsNullOrEmpty(Model.BloodType))
                            {
                                <span class="badge bg-danger">@Model.BloodType</span>
                            }
                            else
                            {
                                <span class="text-muted">Not specified</span>
                            }
                        </dd>

                        <dt class="col-sm-4">Address</dt>
                        <dd class="col-sm-8">@Model.Address</dd>
                    </dl>
                </div>
            </div>

            <!-- Emergency Contacts -->
            <div class="card shadow-sm mb-4">
                <div class="card-header bg-warning text-dark">
                    <h5 class="mb-0">
                        <i class="bi bi-telephone"></i> Emergency Contacts
                    </h5>
                </div>
                <div class="card-body">
                    <dl class="row">
                        <dt class="col-sm-4">Emergency Contact</dt>
                        <dd class="col-sm-8">@Model.EmergencyContact</dd>

                        <dt class="col-sm-4">Emergency Number</dt>
                        <dd class="col-sm-8">@Model.EmergencyContactNumber</dd>

                        <dt class="col-sm-4">Next of Kin</dt>
                        <dd class="col-sm-8">@Model.NextOfKin</dd>

                        <dt class="col-sm-4">Next of Kin Contact</dt>
                        <dd class="col-sm-8">@Model.NextOfKinContact</dd>
                    </dl>
                </div>
            </div>
        </div>

        <!-- Current Assignment -->
        <div class="col-md-6">
            <div class="card shadow-sm mb-4">
                <div class="card-header bg-info text-white">
                    <h5 class="mb-0">
                        <i class="bi bi-building"></i> Current Assignment
                    </h5>
                </div>
                <div class="card-body">
                    <dl class="row">
                        <dt class="col-sm-4">Ward</dt>
                        <dd class="col-sm-8">
                            @if (Model.Ward != null)
                            {
                                <span class="badge bg-primary">@Model.Ward.Name</span>
                            }
                            else
                            {
                                <span class="text-muted">Not assigned</span>
                            }
                        </dd>

                        <dt class="col-sm-4">Bed</dt>
                        <dd class="col-sm-8">
                            @if (Model.Bed != null)
                            {
                                <span class="badge bg-secondary">@Model.Bed.BedNumber</span>
                            }
                            else
                            {
                                <span class="text-muted">Not assigned</span>
                            }
                        </dd>

                        <dt class="col-sm-4">Assigned Doctor</dt>
                        <dd class="col-sm-8">
                            @if (Model.AssignedDoctor != null)
                            {
                                <span class="badge bg-success">@Model.AssignedDoctor.FirstName @Model.AssignedDoctor.LastName</span>
                            }
                            else
                            {
                                <span class="text-muted">Not assigned</span>
                            }
                        </dd>

                        <dt class="col-sm-4">Patient Status</dt>
                        <dd class="col-sm-8">
                            @if (Model.PatientStatus == "Admitted")
                            {
                                <span class="badge bg-success">@Model.PatientStatus</span>
                            }
                            else if (Model.PatientStatus == "Discharged")
                            {
                                <span class="badge bg-secondary">@Model.PatientStatus</span>
                            }
                            else
                            {
                                <span class="badge bg-warning">@Model.PatientStatus</span>
                            }
                        </dd>
                    </dl>
                </div>
            </div>

            <!-- Medical Information -->
            <div class="card shadow-sm mb-4">
                <div class="card-header bg-danger text-white">
                    <h5 class="mb-0">
                        <i class="bi bi-heart-pulse"></i> Medical Information
                    </h5>
                </div>
                <div class="card-body">
                    <dl class="row">
                        <dt class="col-sm-4">Chronic Medications</dt>
                        <dd class="col-sm-8">
                            @if (!string.IsNullOrEmpty(Model.ChronicMedications))
                            {
                                @Model.ChronicMedications
                            }
                            else
                            {
                                <span class="text-muted">None recorded</span>
                            }
                        </dd>

                        <dt class="col-sm-4">Medical History</dt>
                        <dd class="col-sm-8">
                            @if (!string.IsNullOrEmpty(Model.MedicalHistory))
                            {
                                @Model.MedicalHistory
                            }
                            else
                            {
                                <span class="text-muted">None recorded</span>
                            }
                        </dd>

                        <dt class="col-sm-4">Known Allergies</dt>
                        <dd class="col-sm-8">
                            @if (!string.IsNullOrEmpty(Model.Allergies))
                            {
                                <span class="badge bg-warning text-dark">@Model.Allergies</span>
                            }
                            else
                            {
                                <span class="text-muted">None recorded</span>
                            }
                        </dd>

                        <dt class="col-sm-4">Admission Reason</dt>
                        <dd class="col-sm-8">
                            @if (!string.IsNullOrEmpty(Model.AdmissionReason))
                            {
                                @Model.AdmissionReason
                            }
                            else
                            {
                                <span class="text-muted">Not specified</span>
                            }
                        </dd>
                    </dl>
                </div>
            </div>
        </div>
    </div>

    <!-- Quick Actions -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card shadow-sm">
                <div class="card-header bg-secondary text-white">
                    <h5 class="mb-0">
                        <i class="bi bi-gear"></i> Quick Actions
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-3 mb-2">
                            <a asp-action="ManageAllergies" asp-route-id="@Model.Id" class="btn btn-outline-warning w-100">
                                <i class="bi bi-exclamation-triangle"></i> Manage Allergies
                            </a>
                        </div>
                        <div class="col-md-3 mb-2">
                            <a asp-action="ManageConditions" asp-route-id="@Model.Id" class="btn btn-outline-info w-100">
                                <i class="bi bi-heart-pulse"></i> Medical Conditions
                            </a>
                        </div>
                        <div class="col-md-3 mb-2">
                            <a asp-action="ManageMovements" asp-route-id="@Model.Id" class="btn btn-outline-primary w-100">
                                <i class="bi bi-arrow-left-right"></i> Patient Movements
                            </a>
                        </div>
                        <div class="col-md-3 mb-2">
                            <a asp-action="Details" asp-route-id="@Model.Id" class="btn btn-outline-secondary w-100">
                                <i class="bi bi-eye"></i> View Details
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Recent Activity -->
    <div class="row">
        <div class="col-md-6">
            <div class="card shadow-sm">
                <div class="card-header bg-success text-white">
                    <h5 class="mb-0">
                        <i class="bi bi-clock-history"></i> Recent Movements
                    </h5>
                </div>
                <div class="card-body">
                    @if (Model.PatientMovements != null && Model.PatientMovements.Any())
                    {
                        <div class="list-group list-group-flush">
                            @foreach (var movement in Model.PatientMovements.Take(5).OrderByDescending(m => m.MovementDate))
                            {
                                <div class="list-group-item">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <div>
                                            <strong>@movement.FromWard?.Name → @movement.ToWard?.Name</strong>
                                            <br />
                                            <small class="text-muted">@movement.MovementDate.ToString("dd/MM/yyyy HH:mm")</small>
                                        </div>
                                        <span class="badge bg-primary">Movement</span>
                                    </div>
                                </div>
                            }
                        </div>
                    }
                    else
                    {
                        <p class="text-muted">No movements recorded</p>
                    }
                </div>
            </div>
        </div>

        <div class="col-md-6">
            <div class="card shadow-sm">
                <div class="card-header bg-info text-white">
                    <h5 class="mb-0">
                        <i class="bi bi-list-check"></i> Allergies & Conditions
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <h6 class="text-warning">Allergies (@(Model.PatientAllergies?.Count ?? 0))</h6>
                            @if (Model.PatientAllergies != null && Model.PatientAllergies.Any())
                            {
                                <ul class="list-unstyled">
                                    @foreach (var allergy in Model.PatientAllergies.Take(3))
                                    {
                                        <li><small class="text-muted">• @allergy.AllergyName</small></li>
                                    }
                                </ul>
                            }
                            else
                            {
                                <p class="text-muted small">No allergies recorded</p>
                            }
                        </div>
                        <div class="col-md-6">
                            <h6 class="text-info">Medical Conditions (@(Model.MedicalConditions?.Count ?? 0))</h6>
                            @if (Model.MedicalConditions != null && Model.MedicalConditions.Any())
                            {
                                <ul class="list-unstyled">
                                    @foreach (var condition in Model.MedicalConditions.Take(3))
                                    {
                                        <li><small class="text-muted">• @condition.ConditionName</small></li>
                                    }
                                </ul>
                            }
                            else
                            {
                                <p class="text-muted small">No conditions recorded</p>
                            }
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
